<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo Finance Pro · Tech Portfolio Risk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background-color: #eef2ff;
            color: #0f172a;
        }

        /* #bright-content-1,
        #bright-content-2 {
            color: transparent;
            -webkit-text-fill-color: transparent;
        } */

        .metric-card {
            background: linear-gradient(135deg, rgba(93, 63, 211, 0.15), rgba(15, 118, 110, 0.15));
        }

        .mini-candle {
            height: 72px;
            width: 16px;
            margin: 0 auto;
            position: relative;
        }

        .mini-candle::before {
            content: "";
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            top: 4px;
            bottom: 4px;
            background-color: rgba(34, 197, 94, 0.6);
        }

        .mini-candle::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: 16px;
            bottom: 24px;
            border-radius: 4px;
            background: linear-gradient(180deg, rgba(34, 197, 94, 0.6), rgba(21, 128, 61, 0.7));
        }

        .bright-placeholder {
            display: block;
            width: 100%;
            min-height: 1.75rem;
        }

        .masked-text {
            color: transparent;
            -webkit-text-fill-color: transparent;
            background-repeat: no-repeat;
            background-size: cover;
        }

        #bright-content-3 {
            table-layout: fixed;
            width: 100%;
        }

        #bright-content-3 th,
        #bright-content-3 td {
            vertical-align: middle;
        }

        #bright-content-3 col.col-code {
            width: 30%;
        }

        #bright-content-3 col.col-weight {
            width: 12%;
        }

        #bright-content-3 col.col-beta {
            width: 18%;
        }

        #bright-content-3 col.col-commentary {
            width: 40%;
        }
    </style>
</head>

<body>
    <header class="bg-[#410093] text-white shadow">
        <div class="max-w-6xl mx-auto px-6 py-5 flex items-center justify-between">
            <div>
                <p class="uppercase tracking-[0.3em] text-xs text-indigo-200">Yahoo Finance Pro</p>
                <h1 class="text-2xl font-semibold">Tech Portfolio Risk Console</h1>
            </div>
            <div class="text-right text-sm">
                <p>登录账号：<span class="font-semibold">hkus3lab.quant</span></p>
                <p class="text-indigo-200">多因素风控沙盒 · 实时同步</p>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-10 grid lg:grid-cols-[1.6fr_1fr] gap-6">
        <section class="space-y-6">
            <div class="metric-card rounded-2xl border border-indigo-100 backdrop-blur bg-white/90 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-semibold">科技股持仓利率冲击暴露</h2>
                        <p class="text-sm text-slate-600 mt-1">联储 2025Q1 Hawkish 场景 · 实时更新</p>
                    </div>
                    <div class="text-right">
                        <label class="text-xs text-indigo-600 uppercase">Stress Scenario (%)</label>
                        <input id="stress-range" type="range" min="0" max="150" value="80"
                            class="w-40 accent-emerald-400">
                    </div>
                </div>
                <div class="grid md:grid-cols-4 gap-4 mt-6 text-sm">
                    <div class="bg-white rounded-xl p-4 border border-white/60 shadow-sm">
                        <p class="text-slate-500 text-xs uppercase">组合净值</p>
                        <p class="text-2xl font-semibold mt-1" id="nav-value">$12.84M</p>
                        <p class="text-emerald-600 text-xs mt-1">+1.2% 今日</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-white/60 shadow-sm">
                        <p class="text-slate-500 text-xs uppercase">利率敏感 Beta</p>
                        <p class="text-2xl font-semibold mt-1" id="beta-value">1.46</p>
                        <p class="text-slate-500 text-xs mt-1">对 25bps 加息冲击</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-white/60 shadow-sm">
                        <p class="text-slate-500 text-xs uppercase">最大回撤 (模拟)</p>
                        <p class="text-2xl font-semibold mt-1" id="drawdown-value">-6.2%</p>
                        <p class="text-rose-500 text-xs mt-1">99% C.L. 五日窗口</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-white/60 shadow-sm">
                        <p class="text-slate-500 text-xs uppercase">对冲缺口</p>
                        <p class="text-2xl font-semibold mt-1" id="hedge-gap">$2.1M</p>
                        <p class="text-slate-500 text-xs mt-1">需额外国债久期</p>
                    </div>
                </div>
            </div>

            <div class="bg-white border border-slate-100 rounded-2xl shadow-sm">
                <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
                    <div>
                        <div id="bright-container-1" style="margin-top: -100px;">
                            <div id="bright-content-1"
                                class="bright-placeholder text-lg font-semibold tracking-tight leading-tight"></div>
                        </div>
                        <div id="bright-container-2">
                            <p id="bright-content-2" class="bright-placeholder text-sm text-slate-500"></p>
                        </div>
                    </div>
                    <!-- <span class="text-xs text-emerald-600 font-semibold">实时同步</span> -->
                </div>
                <div class="px-6 py-4 overflow-x-auto" id="bright-container-3">
                    <table class="w-full text-sm" id="bright-content-3" style="height: 500px;">
                        <colgroup>
                            <col class="col-code">
                            <col class="col-weight">
                            <col class="col-beta">
                            <col class="col-commentary">
                        </colgroup>
                        <thead class="text-left text-slate-500 uppercase text-xs tracking-wide">
                            <tr>
                                <th class="py-2 pr-4">代码 / 名称</th>
                                <th class="py-2 pr-4">组合权重</th>
                                <th class="py-2 pr-4">Rate Hike Beta</th>
                                <th class="py-2 pr-4">联储政策点评</th>
                            </tr>
                        </thead>
                        <tbody id="bright-table-body" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white border border-slate-100 rounded-2xl shadow-sm">
                <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
                    <div>
                        <h2 class="text-lg font-semibold">实时蜡烛图回放</h2>
                        <p class="text-xs text-slate-500">GUI-Agent 通过 WebSocket 拉取 5s 刷新快照</p>
                    </div>
                    <span class="text-xs text-slate-500">纽约时区 09:42:17</span>
                </div>
                <div class="px-6 py-5 grid md:grid-cols-3 gap-4 text-sm">
                    <div class="border border-slate-100 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <p class="font-semibold">NVDA</p>
                            <span class="text-emerald-600 text-xs">+2.4%</span>
                        </div>
                        <div class="mini-candle my-3"></div>
                        <p class="text-xs text-slate-500">H: <span class="font-semibold">$942.10</span> · L: <span
                                class="font-semibold">$918.40</span></p>
                        <p class="text-xs text-slate-500">成交量 <span class="font-semibold">8.2M</span></p>
                    </div>
                    <div class="border border-slate-100 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <p class="font-semibold">MSFT</p>
                            <span class="text-rose-500 text-xs">-0.3%</span>
                        </div>
                        <div class="mini-candle my-3"></div>
                        <p class="text-xs text-slate-500">H: <span class="font-semibold">$432.80</span> · L: <span
                                class="font-semibold">$428.05</span></p>
                        <p class="text-xs text-slate-500">成交量 <span class="font-semibold">3.1M</span></p>
                    </div>
                    <div class="border border-slate-100 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <p class="font-semibold">TSLA</p>
                            <span class="text-emerald-600 text-xs">+1.1%</span>
                        </div>
                        <div class="mini-candle my-3"></div>
                        <p class="text-xs text-slate-500">H: <span class="font-semibold">$213.45</span> · L: <span
                                class="font-semibold">$205.22</span></p>
                        <p class="text-xs text-slate-500">成交量 <span class="font-semibold">12.4M</span></p>
                    </div>
                </div>
            </div>
        </section>

        <aside class="space-y-6">
            <div class="bg-white border border-slate-100 rounded-2xl shadow-sm p-5">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold">分散化建议</h2>
                    <span class="text-xs text-emerald-600 font-semibold">AI Assistant Draft</span>
                </div>
                <ol class="mt-4 space-y-4 text-sm text-slate-600">
                    <li>
                        <p class="font-semibold text-slate-900">1. 降低半导体集中度</p>
                        <p class="mt-1">将 NVDA/AMD 权重各下调 4%，转入 XLK 防御 ETF。</p>
                    </li>
                    <li>
                        <p class="font-semibold text-slate-900">2. 增配美元现金替代</p>
                        <p class="mt-1">买入 6 个月期 SOFR 期货多头，对冲短端利率意外。</p>
                    </li>
                    <li>
                        <p class="font-semibold text-slate-900">3. 加入能源反向相关</p>
                        <p class="mt-1">建立 XLE 5% 权重，以平衡通胀二阶冲击。</p>
                    </li>
                </ol>
            </div>

            <div class="bg-white border border-slate-100 rounded-2xl shadow-sm p-5">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold">执行队列</h2>
                    <button class="text-xs text-indigo-600">刷新 FIX</button>
                </div>
                <ul class="mt-4 space-y-3 text-sm text-slate-600">
                    <li class="flex items-start gap-3">
                        <span class="w-2.5 h-2.5 rounded-full bg-emerald-400 mt-1"></span>
                        <div>
                            <p class="font-medium">下单 14:05 · 卖出 NVDA 1,200 股</p>
                            <p class="text-xs text-slate-500">限价 $935.50 · 状态：部分成交 42%</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-2.5 h-2.5 rounded-full bg-amber-400 mt-1"></span>
                        <div>
                            <p class="font-medium">下单 14:08 · 买入 SOFRM5 多头</p>
                            <p class="text-xs text-slate-500">盈亏平衡收益 18bps</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-2.5 h-2.5 rounded-full bg-rose-400 mt-1"></span>
                        <div>
                            <p class="font-medium">待审批 · 启用油气对冲篮子</p>
                            <p class="text-xs text-slate-500">合规核查截止 15:00</p>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="bg-white border border-slate-100 rounded-2xl shadow-sm p-5">
                <h2 class="text-lg font-semibold">事件追踪</h2>
                <div class="mt-4 space-y-3 text-sm text-slate-600">
                    <div class="flex items-start gap-3">
                        <span class="text-xs font-semibold text-indigo-600 mt-0.5">FOMC</span>
                        <p>鲍威尔新闻发布会实录自动抓取，关键词“higher for longer”出现 7 次。</p>
                    </div>
                    <div class="flex items-start gap-3">
                        <span class="text-xs font-semibold text-indigo-600 mt-0.5">DOT PLOT</span>
                        <p>终端利率上调至 5.65%，模型已同步。</p>
                    </div>
                    <div class="flex items-start gap-3">
                        <span class="text-xs font-semibold text-indigo-600 mt-0.5">GDP NOW</span>
                        <p>亚特兰大联储即时 GDP 站上 2.8%，触发加码对冲提醒。</p>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        const stressRange = document.getElementById('stress-range');
        const betaValue = document.getElementById('beta-value');
        const drawdownValue = document.getElementById('drawdown-value');
        const hedgeGap = document.getElementById('hedge-gap');

        if (stressRange) {
            stressRange.addEventListener('input', (event) => {
                const factor = Number(event.target.value) / 100;
                betaValue.textContent = (1.1 + factor * 0.6).toFixed(2);
                drawdownValue.textContent = `-${(3 + factor * 4.2).toFixed(1)}%`;
                hedgeGap.textContent = `$${(1.2 + factor * 1.5).toFixed(1)}M`;
            });
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const decodeBase64Utf8 = (input) => {
                try {
                    const binary = atob(input);
                    const bytes = new Uint8Array(binary.length);
                    for (let i = 0; i < binary.length; i += 1) {
                        bytes[i] = binary.charCodeAt(i);
                    }
                    if (window.TextDecoder) {
                        return new TextDecoder().decode(bytes);
                    }
                    const fallback = Array.from(bytes).map((byte) => `%${(`00${byte.toString(16)}`).slice(-2)}`).join('');
                    return decodeURIComponent(fallback);
                } catch (error) {
                    console.error('Base64 decode failed', error);
                    return '';
                }
            };

            const escapeXml = (value = '') => value
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');

            const getFontMetrics = (element) => {
                const computed = window.getComputedStyle(element);
                const fontSize = parseFloat(computed.fontSize) || 16;
                const lineHeight = computed.lineHeight === 'normal'
                    ? fontSize * 1.4
                    : parseFloat(computed.lineHeight) || fontSize * 1.4;
                return {
                    fontFamily: computed.fontFamily || 'Inter, sans-serif',
                    fontWeight: computed.fontWeight || '600',
                    textAlign: computed.textAlign || 'left',
                    fontSize,
                    lineHeight,
                };
            };

            const getMeasureContext = (() => {
                let canvas;
                return () => {
                    if (!canvas) {
                        canvas = document.createElement('canvas');
                    }
                    return canvas.getContext('2d');
                };
            })();

            const wrapText = (text, width, metrics) => {
                const ctx = getMeasureContext();
                ctx.font = `${metrics.fontWeight} ${metrics.fontSize}px ${metrics.fontFamily}`;
                const tokens = /\s/.test(text) ? text.split(/(\s+)/) : Array.from(text);
                const lines = [];
                let current = '';
                tokens.forEach((token) => {
                    if (!token) {
                        return;
                    }
                    const tentative = current + token;
                    if (ctx.measureText(tentative).width > width && current.trim()) {
                        lines.push(current);
                        current = token.trimStart();
                    } else {
                        current = tentative;
                    }
                });
                if (current) {
                    lines.push(current);
                }
                return lines.length ? lines : [''];
            };

            const buildMaskDataUrl = (text, element) => {
                const rect = element.getBoundingClientRect();
                const metrics = getFontMetrics(element);
                const width = Math.max(rect.width || element.clientWidth || 320, 120);
                const contentWidth = width - 12;
                const lines = wrapText(text, contentWidth, metrics);
                const height = Math.max(rect.height || element.clientHeight || metrics.lineHeight * lines.length + metrics.lineHeight, metrics.lineHeight * 1.5);
                const startY = metrics.lineHeight;
                const tspans = lines.map((line, index) => {
                    const y = startY + index * metrics.lineHeight;
                    const anchor = metrics.textAlign === 'center'
                        ? 'middle'
                        : metrics.textAlign === 'right'
                            ? 'end'
                            : 'start';
                    const x = anchor === 'middle'
                        ? width / 2
                        : anchor === 'end'
                            ? width - 6
                            : 6;
                    return `<tspan x="${x}" y="${y}">${escapeXml(line)}</tspan>`;
                }).join('');
                const svg = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
                        <style>
                            text {
                                font-family: ${metrics.fontFamily};
                                font-size: ${metrics.fontSize}px;
                                font-weight: ${metrics.fontWeight};
                                fill: white;
                            }
                        </style>
                        <text>${tspans}</text>
                    </svg>
                `;
                return {
                    dataUrl: `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`,
                    width,
                    height,
                };
            };

            const maskedElements = [];
            let maskScheduled = false;

            const scheduleMaskFlush = () => {
                if (maskScheduled) {
                    return;
                }
                maskScheduled = true;
                requestAnimationFrame(() => {
                    maskScheduled = false;
                    maskedElements.splice(0).forEach(({ element, text }) => {
                        if (!element || !text) {
                            return;
                        }
                        const { dataUrl, width, height } = buildMaskDataUrl(text, element);
                        element.classList.add('masked-text');
                        element.textContent = '';
                        element.style.backgroundImage = 'linear-gradient(130deg, rgba(129, 140, 248, 0.7), rgba(14, 165, 233, 0.8))';
                        element.style.maskImage = `url("${dataUrl}")`;
                        element.style.webkitMaskImage = `url("${dataUrl}")`;
                        element.style.maskSize = `${width}px ${height}px`;
                        element.style.webkitMaskSize = `${width}px ${height}px`;
                        element.style.maskRepeat = 'no-repeat';
                        element.style.webkitMaskRepeat = 'no-repeat';
                        element.style.maskPosition = 'center';
                        element.style.webkitMaskPosition = 'center';
                    });
                });
            };

            const applyMaskedText = (elementId, base64Value) => {
                const element = document.getElementById(elementId);
                const text = decodeBase64Utf8(base64Value);
                if (element && text) {
                    maskedElements.push({ element, text });
                    scheduleMaskFlush();
                }
            };

            applyMaskedText('bright-content-1', '5oyB5LuTRmVk5pWP5oSf5bqm5YiG5biD');
            applyMaskedText('bright-content-2', '5p2l5rqQ77yaR1VJLUFnZW50IOaKk+WPliBZYWhvbyBGaW5hbmNlIFBvcnRmb2xpbw==');

            const tablePayload = decodeBase64Utf8('eyJoZWFkZXJzIjogWyLku6PnoIEgLyDlkI3np7AiLCAi57uE5ZCI5p2D6YeNIiwgIlJhdGUgSGlrZSBCZXRhIiwgIuiBlOWCqOaUv+etlueCueivhCJdLCAicm93cyI6IFt7InN5bWJvbCI6ICJBQVBMIiwgIm5hbWUiOiAiQXBwbGUiLCAid2VpZ2h0IjogIjE4LjUlIiwgImJldGEiOiAiMS4xOCIsICJjb21tZW50YXJ5IjogIuacjeWKoS/noazku7bnjrDph5HmtYHnqLPlrprvvIzliKnnjoflhrLlh7vlj6/lr7nlhrIgNDAlIn0sIHsic3ltYm9sIjogIk1TRlQiLCAibmFtZSI6ICJNaWNyb3NvZnQiLCAid2VpZ2h0IjogIjIyLjMlIiwgImJldGEiOiAiMS4wNSIsICJjb21tZW50YXJ5IjogIuS6keaUtuWFpemUgeWumu+8jEJldGEg5L2O5LqO5p2/5Z2XIn0sIHsic3ltYm9sIjogIk5WREEiLCAibmFtZSI6ICJOdmlkaWEiLCAid2VpZ2h0IjogIjI0LjclIiwgImJldGEiOiAiMS43MiIsICJjb21tZW50YXJ5IjogIkFJIENhcEV4IOWKoOmAn+WvvOiHtOWvueWGsue8uuWPoyJ9LCB7InN5bWJvbCI6ICJUU0xBIiwgIm5hbWUiOiAiVGVzbGEiLCAid2VpZ2h0IjogIjExLjIlIiwgImJldGEiOiAiMS45NSIsICJjb21tZW50YXJ5IjogIuiejei1hOaIkOacrOW8ueaAp+aegemrmO+8jEZlZCDot6/lvoTmlY/mhJ8ifSwgeyJzeW1ib2wiOiAiQU1EIiwgIm5hbWUiOiAiQWR2YW5jZWQgTWljcm8gRGV2aWNlcyIsICJ3ZWlnaHQiOiAiOS4xJSIsICJiZXRhIjogIjEuNTYiLCAiY29tbWVudGFyeSI6ICJBSS9QQyDmt7flkIjmmrTpnLLvvIzpnIDopoHms6Lliqjlr7nlhrIifV19');

            try {
                const tableData = JSON.parse(tablePayload);
                const tbody = document.getElementById('bright-table-body');
                if (!tbody) {
                    return;
                }
                tbody.innerHTML = '';

                tableData.rows.forEach((entry) => {
                    const tr = document.createElement('tr');

                    const codeCell = document.createElement('td');
                    codeCell.className = 'py-3 pr-4';
                    tr.appendChild(codeCell);
                    maskedElements.push({ element: codeCell, text: `${entry.symbol} · ${entry.name}` });

                    const weightCell = document.createElement('td');
                    weightCell.className = 'py-3 pr-4';
                    tr.appendChild(weightCell);
                    maskedElements.push({ element: weightCell, text: entry.weight });

                    const betaCell = document.createElement('td');
                    betaCell.className = 'py-3 pr-4';
                    tr.appendChild(betaCell);
                    maskedElements.push({ element: betaCell, text: entry.beta });

                    const commentaryCell = document.createElement('td');
                    commentaryCell.className = 'py-3 pr-4 text-slate-600';
                    tr.appendChild(commentaryCell);
                    maskedElements.push({ element: commentaryCell, text: entry.commentary });

                    tbody.appendChild(tr);
                });
                scheduleMaskFlush();
            } catch (error) {
                console.error('Table payload parse failed', error);
            }
        });
    </script>
</body>

</html>
